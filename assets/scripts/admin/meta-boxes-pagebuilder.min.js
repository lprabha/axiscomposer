jQuery(function(a){var b={pagebuilder:null,init:function(){this.pagebuilder=a("#axisbuilder-editor").find(":input.axisbuilder-status"),this.stupidtable.init(),a("#axisbuilder-editor").on("click","a.axisbuilder-change-column-size:not(.axisbuilder-change-cell-size)",this.resize_layout).on("click","a.trash-data",this.trash_data).on("click",".axisbuilder-edit",this.edit_element).on("click","a.axisbuilder-cell-set",this.cell_size),a("body").on("axisbuilder_backbone_modal_loaded",this.backbone.init).on("axisbuilder_backbone_modal_response",this.backbone.response)},block:function(){a("#axisbuilder-editor").block({message:null,overlayCSS:{background:"#fff",opacity:.6}})},unblock:function(){a("#axisbuilder-editor").unblock()},init_tiptip:function(){a("#tiptip_holder").removeAttr("style"),a("#tiptip_arrow").removeAttr("style"),a(".tips").tipTip({attribute:"data-tip",fadeIn:50,fadeOut:50,delay:200})},history_snapshot:function(b){setTimeout(function(){a(".canvas-area").trigger("axisbuilder-storage-update")},b?b:150)},trash_data:function(){var b=a(".canvas-area").children().length;return a(this).AxisBuilderBackboneModal({title:axisbuilder_admin_meta_boxes_builder.i18n_trash_all_elements_title,message:b>0?axisbuilder_admin_meta_boxes_builder.i18n_trash_all_elements_message:axisbuilder_admin_meta_boxes_builder.i18n_trash_all_elements_atleast,dismiss:b>0?!1:!0,template:"#tmpl-axisbuilder-modal-trash-data"}),!1},edit_element:function(){var b=a(this).parents(".axisbuilder-sortable-element:eq(0)");return b.length||(b=a(this).parents(".axisbuilder-layout-cell:eq(0)"),b.length||(b=a(this).parents(".axisbuilder-layout-section:eq(0)"))),a(this).AxisBuilderBackboneModal({title:b.data("modal-title"),screen:b.data("modal-class"),message:"Fetch options field with validation using AJAX...",template:"#tmpl-axisbuilder-modal-edit-element"}),!1},resize_layout:function(){for(var c=a(this).is(".axisbuilder-increase")?1:-1,d=a(this).parents(".axisbuilder-layout-column:eq(0)"),e=d.parents(".axisbuilder-layout-section:eq(0)"),f=d.data("width"),g=d.find(".axisbuilder-column-size"),h=d.find('.axisbuilder-inner-shortcode > textarea[data-name="text-shortcode"]'),i=h.val(),j=[],k=[["ab_one_full","1/1"],["ab_four_fifth","4/5"],["ab_three_fourth","3/4"],["ab_two_third","2/3"],["ab_three_fifth","3/5"],["ab_one_half","1/2"],["ab_two_fifth","2/5"],["ab_one_third","1/3"],["ab_one_fourth","1/4"],["ab_one_fifth","1/5"]],l=0;l<k.length;l++)k[l][0]===f&&(j=k[l-c]);"undefined"!=typeof j&&(i=i.replace(new RegExp("^\\["+f,"g"),"["+j[0]),i=i.replace(new RegExp(f+"\\]","g"),j[0]+"]"),h.val(i),d.removeClass(f).addClass(j[0]),d.attr("data-width",j[0]).data("width",j[0]),g.text(j[1]),b.textarea.outer(),e.length&&(b.textarea.inner(!1,e),b.textarea.outer()),b.history_snapshot())},cell_size:function(){var b,d=a(this).parents(".axisbuilder-layout-row:eq(0)"),e=d.find(".axisbuilder-layout-cell"),f=c.cell_size,g=c.cell_size_variations[e.length],h="";if(g)for(var i in g){var j="",k="";for(var l in g[i]){for(var m in f)f[m][0]===g[i][l]&&(k=f[m][1]);j+='<span class="axisbuilder-modal-label '+g[i][l]+'">'+k+"</span>"}h+='<div class="axisbuilder-layout-row-modal"><label class="axisbuilder-layout-row-modal-label"><input type="radio" id="add_cell_size_'+i+'" name="add_cell_size" value="'+i+'" /><span class="axisbuilder-layout-row-inner-label">'+j+"</span></label></div>"}else b=!0,h+=axisbuilder_admin_meta_boxes_builder.i18n_no_layout+"<br />",h+=1===e.length?axisbuilder_admin_meta_boxes_builder.i18n_add_one_cell:axisbuilder_admin_meta_boxes_builder.i18n_remove_one_cell;return a(this).AxisBuilderBackboneModal({title:axisbuilder_admin_meta_boxes_builder.i18n_select_cell_layout,message:h,dismiss:b,template:"#tmpl-axisbuilder-modal-cell-size"}),!1},backbone:{init:function(b,c){"#tmpl-axisbuilder-modal-edit-element"===c&&a("body").trigger("axisbuilder-enhanced-select-init")},response:function(a,c,d){"#tmpl-axisbuilder-modal-trash-data"===c&&b.backbone.trash_data(),"#tmpl-axisbuilder-modal-edit-element"===c&&b.backbone.edit_element(),"#tmpl-axisbuilder-modal-cell-size"===c&&b.backbone.cell_size(d.add_cell_size)},trash_data:function(){a(".canvas-area").empty(),b.textarea.outer()},edit_element:function(){},cell_size:function(d){var e=a("a.axisbuilder-cell-set").parents(".axisbuilder-layout-row:eq(0)"),f=e.find(".axisbuilder-layout-cell"),g=c.cell_size_variations[f.length];d&&(c.change_multiple_cell_size(f,g[d],!0),b.textarea.inner(!1,e),b.textarea.outer(),b.history_snapshot())}},textarea:{inner:function(c,d){if("undefined"==typeof d&&(d=a(c).parents(".axisbuilder-layout-section:eq(0)")),d.length||(d=a(c).parents(".axisbuilder-layout-column:eq(0)")),!d.length)return!0;var e,f,g,h,i,j,k;if(d.is(".axisbuilder-layout-section")){var l=d.find(".axisbuilder-layout-column-no-cell");for(e=0;e<l.length;e++)b.textarea.inner(!1,a(l[e]));for(l=d.find(".axisbuilder-layout-cell"),e=0;e<l.length;e++)b.textarea.inner(!1,a(l[e]));for(f="",j=d.data("shortcode-handler"),g=d.find('>.axisbuilder-inner-shortcode >textarea[data-name="text-shortcode"]'),h=d.find('>.axisbuilder-inner-shortcode > div textarea[data-name="text-shortcode"]:not( .axisbuilder-layout-column .axisbuilder-sortable-element textarea[data-name="text-shortcode"], .axisbuilder-layout-cell .axisbuilder-layout-column textarea[data-name="text-shortcode"] )'),i=g.val().match(new RegExp("\\["+j+".*?\\]")),e=0;e<h.length;e++)f+=a(h[e]).val();f=i[0]+"\n\n"+f+"[/"+j+"]",g.val(f)}if(d.is(".axisbuilder-layout-cell")){for(f="",k=d.data("width"),g=d.find('>.axisbuilder-inner-shortcode >textarea[data-name="text-shortcode"]'),h=d.find('>.axisbuilder-inner-shortcode > div textarea[data-name="text-shortcode"]:not( .axisbuilder-layout-column-no-cell .axisbuilder-sortable-element textarea[data-name="text-shortcode"] )'),i=g.val().match(new RegExp("\\["+k+".*?\\]")),e=0;e<h.length;e++)f+=a(h[e]).val();f=i[0]+"\n\n"+f+"[/"+k+"]",g.val(f)}if(d.is(".axisbuilder-layout-column:not(.axisbuilder-layout-cell)")){var m=d.is(".axisbuilder-first-column")?" first":"";for(f="",k=d.data("width"),h=d.find('.axisbuilder-sortable-element textarea[data-name="text-shortcode"]'),g=d.find('>.axisbuilder-inner-shortcode >textarea[data-name="text-shortcode"]'),e=0;e<h.length;e++)f+=a(h[e]).val();f="["+k+m+"]\n\n"+f+"[/"+k+"]",g.val(f)}},outer:function(c){if("active"===b.pagebuilder.val()){c||(a(".canvas-area").find(".axisbuilder-layout-section").each(function(){var c=a(this).find(">.axisbuilder-inner-shortcode > div > .axisbuilder-inner-shortcode"),d=a(this).find(".axisbuilder-layout-cell .axisbuilder-layout-column-no-cell > .axisbuilder-inner-shortcode");c.length&&b.textarea.outer(c),d.length&&b.textarea.outer(d)}),c=a(".axisbuilder-data > div > .axisbuilder-inner-shortcode"));for(var d,e,f,g,h={ab_one_full:1,ab_four_fifth:.8,ab_three_fourth:.75,ab_two_third:.66,ab_three_fifth:.6,ab_one_half:.5,ab_two_fifth:.4,ab_one_third:.33,ab_one_fourth:.25,ab_one_fifth:.2},i=0,j="",k=c.find('>textarea[data-name="text-shortcode"]'),l=0;l<k.length;l++)d=a(k[l]),e=d.val(),f=d.parents(".axisbuilder-layout-column-no-cell:eq(0)"),f.length?(g=f.data("width"),i+=h[g],i>1||0===l?(f.is(".axisbuilder-first-column")||(f.addClass("axisbuilder-first-column"),e=e.replace(new RegExp("^\\["+g),"["+g+" first"),d.val(e)),i=h[g]):f.is(".axisbuilder-first-column")&&(f.removeClass("axisbuilder-first-column"),e=e.replace(" first",""),d.val(e))):i=1,j+=e;"undefined"!=typeof window.tinyMCE&&setTimeout(function(){window.tinyMCE.get("content").setContent(window.switchEditors.wpautop(j),{format:"html"})},500),a(".canvas-data").val(j),a("#content.wp-editor-area").val(j)}}},stupidtable:{init:function(){a(".axisbuilder_editor").stupidtable().on("aftertablesort",this.add_arrows)},add_arrows:function(b,c){var d=a(this).find("th"),e="asc"===c.direction?"&uarr;":"&darr;",f=c.column;f>1&&(f-=1),d.find(".axisbuilder-arrow").remove(),d.eq(f).append('<span class="axisbuilder-arrow">'+e+"</span>")}}},c={cell_list:[["ab_cell_one_full","1/1"],["ab_cell_one_half","1/2"],["ab_cell_one_third","1/3"],["ab_cell_one_fourth","1/4"],["ab_cell_one_fifth","1/5"]],cell_size:[["ab_cell_one_full","1/1",1],["ab_cell_four_fifth","4/5",.8],["ab_cell_three_fourth","3/4",.75],["ab_cell_two_third","2/3",.66],["ab_cell_three_fifth","3/5",.6],["ab_cell_one_half","1/2",.5],["ab_cell_two_fifth","2/5",.4],["ab_cell_one_third","1/3",.33],["ab_cell_one_fourth","1/4",.25],["ab_cell_one_fifth","1/5",.2]],cell_size_variations:{4:{1:["ab_cell_one_fourth","ab_cell_one_fourth","ab_cell_one_fourth","ab_cell_one_fourth"],2:["ab_cell_one_fifth","ab_cell_one_fifth","ab_cell_one_fifth","ab_cell_two_fifth"],3:["ab_cell_one_fifth","ab_cell_one_fifth","ab_cell_two_fifth","ab_cell_one_fifth"],4:["ab_cell_one_fifth","ab_cell_two_fifth","ab_cell_one_fifth","ab_cell_one_fifth"],5:["ab_cell_two_fifth","ab_cell_one_fifth","ab_cell_one_fifth","ab_cell_one_fifth"]},3:{1:["ab_cell_one_third","ab_cell_one_third","ab_cell_one_third"],2:["ab_cell_one_fourth","ab_cell_one_fourth","ab_cell_one_half"],3:["ab_cell_one_fourth","ab_cell_one_half","ab_cell_one_fourth"],4:["ab_cell_one_half","ab_cell_one_fourth","ab_cell_one_fourth"],5:["ab_cell_one_fifth","ab_cell_one_fifth","ab_cell_three_fifth"],6:["ab_cell_one_fifth","ab_cell_three_fifth","ab_cell_one_fifth"],7:["ab_cell_three_fifth","ab_cell_one_fifth","ab_cell_one_fifth"],8:["ab_cell_one_fifth","ab_cell_two_fifth","ab_cell_two_fifth"],9:["ab_cell_two_fifth","ab_cell_one_fifth","ab_cell_two_fifth"],10:["ab_cell_two_fifth","ab_cell_two_fifth","ab_cell_one_fifth"]},2:{1:["ab_cell_one_half","ab_cell_one_half"],2:["ab_cell_two_third","ab_cell_one_third"],3:["ab_cell_one_third","ab_cell_two_third"],4:["ab_cell_one_fourth","ab_cell_three_fourth"],5:["ab_cell_three_fourth","ab_cell_one_fourth"],6:["ab_cell_one_fifth","ab_cell_four_fifth"],7:["ab_cell_four_fifth","ab_cell_one_fifth"],8:["ab_cell_two_fifth","ab_cell_three_fifth"],9:["ab_cell_three_fifth","ab_cell_two_fifth"]}},change_multiple_cell_size:function(b,d,e){var f="",g=d,h=c.cell_size;b.each(function(b){if(e){f=d[b];for(var i in h)f===h[i][0]&&(g=h[i])}c.change_single_cell_size(a(this),g)})},change_single_cell_size:function(a,b){var c=a.data("width"),d=a.find("> .axisbuilder-sorthandle > .axisbuilder-column-size"),e=a.find('> .axisbuilder-inner-shortcode > textarea[data-name="text-shortcode"]'),f=e.val();f=f.replace(new RegExp("^\\["+c,"g"),"["+b[0]),f=f.replace(new RegExp(c+"\\]","g"),b[0]+"]"),e.val(f),a.removeClass(c).addClass(b[0]),a.attr("data-width",b[0]).data("width",b[0]),a.attr("data-shortcode-handler",b[0]).data("shortcode-handler",b[0]),a.attr("data-shortcode-allowed",b[0]).data("shortcode-allowed",b[0]),d.text(b[1])}};b.init()});